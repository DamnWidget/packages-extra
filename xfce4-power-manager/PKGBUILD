# Based on the file created for Arch Linux by:
# Maintainer : Evangelos Foutras <evangelos@foutrelis.com>
# Contributor: Tobias Kieslich <tobias funnychar archlinux.org>

# Maintainer : Philip MÃ¼ller <philm@manjaro.org>
# Maintainer : Rob McCathie <rob@manjaro.org>

pkgname=xfce4-power-manager
_seriesver=1.4
pkgver=${_seriesver}.0
pkgrel=2
#_git=b3c28d616110e690a8aecbc8d29765e9bbfc67bc
pkgdesc="Power manager for Xfce desktop"
arch=('i686' 'x86_64')
url="http://www.xfce.org/"
license=('GPL2')
groups=('xfce4')
depends=('xfce4-panel' 'upower' 'udisks' 'libnotify' 'hicolor-icon-theme')
makedepends=('intltool' 'xfce4-dev-tools')
#makedepends=('intltool' 'xfce4-dev-tools' 'git')
install=$pkgname.install
source=("http://archive.xfce.org/src/xfce/xfce4-power-manager/${_seriesver}/${pkgname}-${pkgver}.tar.bz2"
        "fix-action-on-laptop-lid-close.reverse.patch::http://git.xfce.org/xfce/xfce4-power-manager/patch/?id=03193df6cad651841e8d9960335b4a3bf13afdad")
#source=(git://git.xfce.org/xfce/xfce4-power-manager)
#source=("$pkgname-$pkgver-$pkgrel.tar.bz2::http://git.xfce.org/xfce/$pkgname/snapshot/$pkgname-$_git.tar.bz2")
sha256sums=('3fba9d1bdb2f535e5a5c2a832503368d26629d6fe496c547fa93a3278d2cf6e7'
            'eb09b2a9c72579e230b1603a661054be27be6dc3337fbf029d01c635e0325968')

#pkgver() {
#  cd "${srcdir}/${pkgname}"
#
#  git describe --long | sed 's/^xfce4-power-manager-//;s/-/./g'
#}

prepare() {
  cd "${srcdir}/${pkgname}-${pkgver}"
#  patch -Np1 -i "${srcdir}/file.patch"
  patch -RNp1 -i "${srcdir}/fix-action-on-laptop-lid-close.reverse.patch"
#
#  cd "${srcdir}/${pkgname}-${_git}"
#  sed -i -e 's|[git])|[])|g' configure.ac.in
}

build() {
  cd "${srcdir}/${pkgname}-${pkgver}"
  #cd "${srcdir}/${pkgname}-${_git}"
  
  #./autogen.sh \
  ./configure \
    --prefix=/usr \
    --sysconfdir=/etc \
    --sbindir=/usr/bin \
    --libexecdir=/usr/lib \
    --localstatedir=/var \
    --disable-network-manager \
    --enable-polkit \
    --enable-dpms \
    --disable-debug

  make
}

package() {
  cd "${srcdir}/${pkgname}-${pkgver}"
  #cd "${srcdir}/${pkgname}-${_git}"
  
  make DESTDIR="${pkgdir}" install
}
